---
title: "Bonanza Creek Snowshoe Hare Report"
author: "Conner Smith"
date: "11/3/2021"
output: 
  html_document: 
    toc: yes
    toc_depth: 2
    theme: flatly
    code_folding: hide
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

# Attach packages.
library(tidyverse)
library(here)
library(lubridate)
library(ggbeeswarm)
library(janitor)
library(kableExtra)
library(broom)
library(effsize)
library(equatiomatic)
```

# **Introduction**

This study explores population dynamics and characteristics of Snowshoe Hares measured at the Bonanza Creek Experimental Forest (Long Term Ecological Research site). The analysis looks at the counts and sizes of juvenile snowshoe hares recorded from 1998 - 2012 ... 

*Data citation: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14*

```{r, include = FALSE}
# Read in the snowshoe hare data 

hares <- read_csv(here("data", "bonanza_hares.csv"))
  
```

# **Data and Methods**

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

# **Juvenile Hare Trapping Summary**

This section includes a summary of the hare count by year.

#### **Figure 1: Count of Bonanza LTER Juvenile Snowshoe Hare Trappings by Year**

```{r}
# Count the total number of juvenile hare trappings (`summarize()` during each year of the study (`group_by()`), and create a finalized data visualization of the counts by year.

hares_juvenile <- hares %>% 
  filter(age == "j") %>% 
  mutate(date_new = mdy(date)) %>%
  mutate(year = year(date_new)) %>% 
  group_by(year)

juvenile_summary <- hares_juvenile %>% 
  count(year) %>% 
  rename(trappings = "n")
  
ggplot(data = hares_juvenile, aes(x = year)) +
  geom_histogram(fill = "slategray2",
                 show.legend = FALSE, binwidth = 0.5) +
  theme_bw() +
  scale_x_continuous(breaks = 1998:2012)+
  labs(x = "Year", y = "Count of Trappings", 
       title = "Juvenile Snowshoe Hare Trappings (1998-2012)")

# Including calculation of mean/median values for the description without generating a summary table.

juvenile_mean <- mean(juvenile_summary$trappings)
juvenile_median <- median(juvenile_summary$trappings)
juvenile_max <- max(juvenile_summary$trappings)
```

**Figure 1: Count of Bonanza LTER Juvenile Snowshoe Hare Trappings by Year.** *This graph shows the spread of juvenile Snowshoe Hare trappings at the Bonanza site between 1998 and 2012.*

The fewest number of juvenile hares (2) were trapped in 2010 and the highest number (126) were trapped in 2009. The average annual hare trappings is around `r round(juvenile_mean)` across the 12 years where juvenile hares were trapped (Note: this calculation does not include the years where no juvenile hares were trapped: 1998; 2002; 2009). The median value is `r round(juvenile_median)`, which falls across two years (2003 and 2011). trappings were highest between 1999 and 2000. This shows an overall decline in the number of juvenile hares trapped at the research site. In order to more confidently assert that this represents an actual decline in the juvenile hare population, the number of traps and time spent trapping would have to be standardized across all study years and sites. If this was not possible for some reason, researchers could use the existing data and create weightings based on number of traps and time spent so years where trapping activity was less are not leading to skewed results. 

# **Juvenile Hare Weight Analysis by Sex and Site**

This section looks for differences in juvenile hare wights across the three study sites and 

#### **Figure 2: Weight Distribution of Bonanza LTER Juvenile Snowshoe Hares by Site**

```{r}
# Compare juvenile hare weights by sex and site (grid), include groups where these variables are not recorded (`NA`). Using a jitter plot to show these comparisons. 

juvenile_weight <- hares_juvenile %>% 
  select(grid, sex, weight) %>% 
  mutate(grid = case_when(grid == "bonbs" ~ "Bonanza Black Spruce",
                               grid == "bonmat" ~ "Bonanza Mature",
                               grid == "bonrip" ~ "Bonanza Riparian")) %>%
  mutate(sex = case_when(sex == "f" ~ "Female",
                               sex == "m" ~ "Male"))

ggplot(data = juvenile_weight, aes(x = sex, y = weight)) +
  geom_jitter(aes(color = sex), width = 0.2, show.legend = FALSE) +
  facet_wrap(~grid) +
  scale_color_manual(values = c("skyblue3", 
                               "slateblue3", 
                               "slategray3")) +
  theme_bw() +
  labs(x = "Sex", y = "Weight (grams)", 
       title = "Juvenile Hare Weight by Sex and Site")
```

**Figure 2: Weigh of Bonanza LTER Juvenile Snowshoe Hares by Site.** *This graph shows the weight distribution of Snowshoe Hare trappings at different site types broken out by hare sex.*

Figure 2 shows that more hares were trapped at the Bonanza Riparian site compared to the Bonanza Black Spruce and Mature sites. It also shows that  overall, the weight differences between juvenile males and female appears to be minimal. The table below provides summary statistics of this data . 

**Table 1: Summary Statistics of Bonanza Hare Weight.** *This table shows summary statistics for hare weights based on trap site and sex.*

```{r}
# Creating a summary table comparing juvenile weights by sex using `kable()`. 

juvenile_stats <- juvenile_weight %>% 
  group_by(sex) %>% 
  summarize(trappings = n(),
            mean_weight = mean(weight, na.rm = TRUE),
            median_weight = median(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE)) 

juvenile_stats %>% 
kable(col.names = c("Sex",
                    "Trappings",
                    "Mean Weights (g)",
                    "Median Size (g)",
                    "Standard Deviation (g)"), digits = 2) %>% 
  kable_styling(full_width = FALSE)

```

```{r, include = FALSE}
# Including some exploration of the differences in data including effect size (Cohen's D) and an unpaired, two-sample t-test. 

mean_diff <- juvenile_stats[2, "mean_weight"] - juvenile_stats[1, "mean_weight"] 

mean_percent <- mean_diff / juvenile_stats[2, "mean_weight"]

# Include exploratory QQ plots to determine if t-tests are appropriate for this data.

ggplot(data = juvenile_weight, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex)

ggplot(data = juvenile_weight, aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~ sex)

# There is nothing substantial in these graphs that leads me to think that a t-test is not appropriate. 

# Run the t test and Cohen's d 

juvenile_male <- juvenile_weight %>% 
  filter(sex == "Male") %>% 
  pull(weight)

juvenile_female <- juvenile_weight %>% 
  filter(sex == "Female") %>% 
  pull(weight)

hare_t <- t.test(juvenile_male, juvenile_female, na.rm = TRUE)

hare_t

hare_cohen <- cohen.d(juvenile_male, juvenile_female, na.rm = TRUE)

hare_cohen

```

The difference in means between the juvenile male and female rabbits is `r round(mean_diff, 2)` grams (or a 'r . The p-value of `r hare_t$p.value` means that there is a `r round(hare_t$p.value, 3)*100` percent chance of finding sample means that are at least as different as the ones shown in the Bonanza samples from two other random samples if they were drawn from populations with the same mean weight. This shows there is a significant difference in the means. The relatively small effect size (Cohen's *d* = `r round(hare_cohen$estimate,2)`) shows that while the means differ, the size of the difference is not very large. 

# **Juvenile Hare Weight and Foot Comparisons** 

This section explores the relationship between juvenile hare wight and foot lengths. 

#### **Figure 3: Weigh and Hind Foot Length of Bonanza LTER Juvenile Snowshoe Hares**

```{r}
# Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight.

hare_foot <- hares_juvenile %>% 
  select(hindft, weight)

ggplot(data = hare_foot, aes(x = weight, y = hindft)) +
  geom_point(color = "slategray3") +
  geom_smooth(method = "lm") +
  theme_bw() +
  labs(x = "Weight (g)", y = "Hind Foot Length (mm)",
       title = "Snowshoe Hare Foot Length by Weight")
  
```

**Figure 3: Weigh and Hind Foot Length of Bonanza LTER Juvenile Snowshoe Hares.** *This graph shows the relationship between weight and hind foot length of snowshoe hares. The graph includes a simple line of best fit assuming a linear relationship between weight and foot length.*

The line of best fit included in Figure 3 shows that these data may not be best described by a linear relationship. The following equation shows the coefficients associated with this model:

```{r, include=FALSE}
# Calculate the coefficients of this model 

hares_lm <- lm(weight ~ hindft, data = hare_foot)

hares_lm_tidy <- tidy(hares_lm)

hares_lm_glance <- glance(hares_lm)

hares_pearson <- cor.test(hare_foot$weight, hare_foot$hindft, method = "pearson", use = "complete.obs")
```

```{r}
# Use equatiomatic:: extract() to generate an equation. 

extract_eq(model = hares_lm, use_coefs = TRUE)
```

This equation shows that the model anticipates an increase of `r round(hares_lm$coefficients[2], 2)` millimeter increase in hare hind foot length for every gram increase in weight. The model has an $R^2$ value of `r round(hares_lm_glance[1, "r.squared"], 3)`. This means that `r round(hares_lm_glance[1, "r.squared"], 3)*100` percent of the variance in the dependent variable (hind foot length) is explained from the independent variable (weight). The Pearson's R value associated with this model is `r round(hares_pearson$estimate, 2)`, indicating a significant but not overwhelmingly strong correlation between these two variables. This provides further indication of earlier concerns that a simple linear regression does not provide a complete explain the relationship between hare weight and hind foot length. Looking at the shape of the data in Figure 3 above, it is reasonable to think that a model with a slightly logarithmic curve could more accurately capture the relationship between Snowshoe Hare weight and foot length. 

Pearson's r? 

# **Summary**

The key takeaways from this analysis can be summarized as follows: 

- There is some inconsistency in the number of juvenile hares trapped over the duration of the study with some years (1998, 2002, and 2009) having no trappings. 

- The most juvenile hares were trapped at the Bonanza Riparian site. 

- The actual difference in mean weights between male and female juvenile hares is `r round(mean_diff, 2)` grams. This difference is significant, although the size of this difference is not large (Cohen's *d* = `r round(hare_cohen$estimate,2)`). 

- The relationship between hare weight and hindfoot length is not best described by a simple linear regression. Under a linear regression, hind foot length could only explain `r round(hares_lm_glance[1, "r.squared"], 3)*100` percent of the variance in weight. A different type of model is likely more appropriate to understand this relationship. 

# **Citations**

*Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14*
